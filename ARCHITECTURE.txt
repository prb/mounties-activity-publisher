═══════════════════════════════════════════════════════════════════════════════
  MOUNTAINEERS ACTIVITIES DISCORD PUBLISHER - ARCHITECTURE
═══════════════════════════════════════════════════════════════════════════════

┌─────────────────────────────────────────────────────────────────────────────┐
│                         TRIGGER (Every 60 minutes)                          │
│                                                                             │
│                         ┌──────────────────┐                               │
│                         │ Cloud Scheduler  │                               │
│                         └────────┬─────────┘                               │
│                                  │ HTTP POST                               │
│                                  ▼                                          │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                            SEARCH PHASE                                     │
│                                                                             │
│  ┌──────────────────┐          ┌─────────────────┐                        │
│  │   Mountaineers   │◄─────────│    Searcher     │                        │
│  │     Website      │  GET     │    Function     │                        │
│  │ (Search Results) │          └────────┬────────┘                        │
│  └──────────────────┘                   │                                  │
│                                          │                                  │
│                                          │ enqueue tasks                    │
│                                          ▼                                  │
│                         ┌─────────────────────────────┐                    │
│                         │   search-queue (10/min)     │─┐ pagination       │
│                         │   scrape-queue (30/min)     │ │                  │
│                         └─────────────────────────────┘ │                  │
│                                          │               │                  │
│                                          └───────────────┘                  │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                           SCRAPE PHASE                                      │
│                                                                             │
│  ┌──────────────────┐          ┌─────────────────┐                        │
│  │   Mountaineers   │◄─────────│    Scraper      │                        │
│  │     Website      │  GET     │    Function     │                        │
│  │ (Activity Detail)│          └────────┬────────┘                        │
│  └──────────────────┘                   │                                  │
│                                          │ store                            │
│                            ┌─────────────▼──────────────┐                  │
│                            │       Firestore            │                  │
│                            │  ┌──────────────────────┐  │                  │
│                            │  │ activities           │  │                  │
│                            │  │   - title            │  │                  │
│                            │  │   - date             │  │                  │
│                            │  │   - leader_ref       │  │                  │
│                            │  │   - place_ref        │  │                  │
│                            │  │   - discord_msg_id   │  │                  │
│                            │  └──────────────────────┘  │                  │
│                            │  ┌──────────────────────┐  │                  │
│                            │  │ leaders              │  │                  │
│                            │  └──────────────────────┘  │                  │
│                            │  ┌──────────────────────┐  │                  │
│                            │  │ places               │  │                  │
│                            │  └──────────────────────┘  │                  │
│                            └─────────────────────────────┘                  │
│                                          │                                  │
│                                          │ enqueue task                     │
│                                          ▼                                  │
│                         ┌─────────────────────────────┐                    │
│                         │  publish-queue (5/min)      │                    │
│                         └─────────────────────────────┘                    │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                          PUBLISH PHASE                                      │
│                                                                             │
│                         ┌─────────────────┐                                │
│                         │   Publisher     │                                │
│                         │   Function      │                                │
│                         └────────┬────────┘                                │
│                                  │                                          │
│                    ┌─────────────┼─────────────┐                           │
│                    │             │             │                           │
│         get activity     get bot token    POST message                     │
│                    │             │             │                           │
│                    ▼             ▼             ▼                           │
│          ┌──────────────┐ ┌────────────┐ ┌─────────────┐                 │
│          │  Firestore   │ │  Secret    │ │   Discord   │                 │
│          │  activities  │ │  Manager   │ │   Channel   │                 │
│          └──────────────┘ └────────────┘ └─────────────┘                 │
│                    │                                                        │
│                    │ update discord_message_id                             │
│                    ▼                                                        │
│          ┌──────────────┐                                                  │
│          │  Firestore   │                                                  │
│          └──────────────┘                                                  │
└─────────────────────────────────────────────────────────────────────────────┘

═══════════════════════════════════════════════════════════════════════════════
  KEY METRICS
═══════════════════════════════════════════════════════════════════════════════

  Cloud Functions:
    • searcher:  ~720 invocations/month  (512MB, 540s timeout)
    • scraper:   ~10,000 invocations/month (512MB, 540s timeout)
    • publisher: ~10,000 invocations/month (256MB, 540s timeout)

  Cloud Tasks Queues:
    • search-queue:  10 dispatches/min, 1 concurrent, 3 retries
    • scrape-queue:  30 dispatches/min, 5 concurrent, 5 retries
    • publish-queue: 5 dispatches/min, 1 concurrent, 3 retries

  Firestore Collections:
    • activities: ~14 new documents per poll
    • leaders:    ~5-10 documents (deduplicated)
    • places:     ~5-10 documents (deduplicated)

  Total Cost: $0/month (within free tier limits)

═══════════════════════════════════════════════════════════════════════════════
